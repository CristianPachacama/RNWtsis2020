if(nclus==4){
p=3;q=2
P=1;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0) retardos = c(retardos,NA)
}
Modelos[[est]] = arima(y,order = c(p,d,q),
seasonal = list(order = c(P,D,Q), period = 12),
fixed = retardos)
# coeftest(Modelos[[est]])
# Modelos  SARIMAX ==========================================================
if(nclus==1){
# Parametros del modelo ...............
media = FALSE
p=1;q=0
P=2;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
#.......................................
# Ordenes Funciones de Respuesta al Impulso
tar1 = 2 #Transf - AR
tma1 = 0 #Transf - MA
tar2 = 0 #Transf - AR
tma2 = 0 #Transf - MA
tar3 = 0 #Transf - AR
tma3 = 0  #Transf - MA
tar4 = 2 #Transf - AR
tma4 = 0  #Transf - MA
tar1_lags = rep(NA, tar1); tma1_lags = rep(NA, tma1+1);
tar2_lags = rep(NA, tar2); tma2_lags = rep(NA, tma2+1);
tar3_lags = rep(NA, tar3); tma3_lags = rep(NA, tma3+1);
tar4_lags = rep(NA, tar4); tma4_lags = rep(NA, tma4+1);
# tar1_lags[5] = 0
# tar4_lags[2] = 0
tma3_lags[1] = 0
tma2_lags[1] = 0
tar4_lags[1] = 0
#........................................
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0 & media) retardos = c(retardos,NA)  # Si include.mean = TRUE  compilar
retardos = c(retardos,
tar1_lags,tma1_lags,
tar2_lags,tma2_lags,
tar3_lags,tma3_lags,
tar4_lags,tma4_lags)
}
if(nclus==2){
# Parametros del modelo ................
media = FALSE
p=1;q=0
P=2;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
#.......................................
# Ordenes Funciones de Respuesta al Impulso
tar1 = 0 #Transf - AR
tma1 = 0 #Transf - MA
tar2 = 0 #Transf - AR
tma2 = 0 #Transf - MA
tar3 = 0 #Transf - AR
tma3 = 0  #Transf - MA
tar4 = 3 #Transf - AR
tma4 = 0  #Transf - MA
tar1_lags = rep(NA, tar1); tma1_lags = rep(NA, tma1+1);
tar2_lags = rep(NA, tar2); tma2_lags = rep(NA, tma2+1);
tar3_lags = rep(NA, tar3); tma3_lags = rep(NA, tma3+1);
tar4_lags = rep(NA, tar4); tma4_lags = rep(NA, tma4+1);
tma1_lags[1] = 0
tma2_lags[1] = 0
tma3_lags[1] = 0
tar4_lags[1] = 0
#........................................
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0 & media) retardos = c(retardos,NA)  # Si include.mean = TRUE  compilar
retardos = c(retardos,
tar1_lags,tma1_lags,
tar2_lags,tma2_lags,
tar3_lags,tma3_lags,
tar4_lags,tma4_lags)
}
if(nclus==3){
# Parametros del modelo ................
media = FALSE
p=1;q=0
P=1;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
#.......................................
# Ordenes Funciones de Respuesta al Impulso
tar1 = 1 #Transf - AR
tma1 = 0 #Transf - MA
tar2 = 0 #Transf - AR
tma2 = 0 #Transf - MA
tar3 = 0 #Transf - AR
tma3 = 0  #Transf - MA
tar4 = 0 #Transf - AR
tma4 = 0  #Transf - MA
tar1_lags = rep(NA, tar1); tma1_lags = rep(NA, tma1+1);
tar2_lags = rep(NA, tar2); tma2_lags = rep(NA, tma2+1);
tar3_lags = rep(NA, tar3); tma3_lags = rep(NA, tma3+1);
tar4_lags = rep(NA, tar4); tma4_lags = rep(NA, tma4+1);
tma3_lags[1] = 0
tma4_lags[1] = 0
# tar4_lags[1] = 0
#........................................
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0 & media) retardos = c(retardos,NA)  # Si include.mean = TRUE  compilar
retardos = c(retardos,
tar1_lags,tma1_lags,
tar2_lags,tma2_lags,
tar3_lags,tma3_lags,
tar4_lags,tma4_lags)
}
if(nclus==4){
# Parametros del modelo ................
media = FALSE
p=0;q=3
P=1;Q=1
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
#.......................................
# Ordenes Funciones de Respuesta al Impulso
tar1 = 0 #Transf - AR
tma1 = 0 #Transf - MA
tar2 = 0 #Transf - AR
tma2 = 0 #Transf - MA
tar3 = 0 #Transf - AR
tma3 = 0  #Transf - MA
tar4 = 0 #Transf - AR
tma4 = 0  #Transf - MA
tar1_lags = rep(NA, tar1); tma1_lags = rep(NA, tma1+1);
tar2_lags = rep(NA, tar2); tma2_lags = rep(NA, tma2+1);
tar3_lags = rep(NA, tar3); tma3_lags = rep(NA, tma3+1);
tar4_lags = rep(NA, tar4); tma4_lags = rep(NA, tma4+1);
# tar1_lags[5] = 0
# tar4_lags[2] = 0
tma1_lags[1] = 0
tma3_lags[1] = 0
tma2_lags[1] = 0
#........................................
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0 & media) retardos = c(retardos,NA)  # Si include.mean = TRUE  compilar
retardos = c(retardos,
tar1_lags,tma1_lags,
tar2_lags,tma2_lags,
tar3_lags,tma3_lags,
tar4_lags,tma4_lags)
}
ModelosX[[est]] = arimax(y, order = c(p,d,q),include.mean = media,
seasonal = list(order = c(P,D,Q),
period = 12),
fixed = retardos,
# fixed = NULL,
xtransf = XblancNmb, transfer = list(c(tar1,tma1),
c(tar2,tma2),
c(tar3,tma3),
c(tar4,tma4))
)
NombreXclima[est] = nmb_clim$Clima
print(paste("Caudal:",names(vazoe[est]),"***********"))
print(paste("Clima:",nmb_clim$Clima))
# coeftest(ModelosX[[est]])
}
names(Modelos) = names(vazoe)
names(ModelosX) = names(vazoe)
save(Modelos,file=paste0("Modelos/SARIMA",nclus,".RData"))
save(ModelosX,NombreXclima,file=paste0("Modelos/SARIMAX",nclus,".RData"))
}
library(tictoc)
library(readxl)
library(readr)
library(dplyr)
library(lmtest)
library(TSA)
library(tictoc)
getwd()
# Datos -----------------
tic()
load(file = "Data/Vazoe.RData")
source("GraficosTablasFunc.R")
Clima1 = read_csv("Data/ClimaLimpio1.csv"); Clima1 = Clima1[,-1]
Clima2 = read_csv("Data/ClimaLimpio2.csv"); Clima2 = Clima2[,-1]
Clima3 = read_csv("Data/ClimaLimpio3.csv"); Clima3 = Clima3[,-1]
Clima4 = read_csv("Data/ClimaLimpio4.csv"); Clima4 = Clima4[,-1]
VazoeClima = read_excel("Data/MinVazoeClima_corregido.xlsx"); VazoeClima = VazoeClima[,-1]
# Medoides Clusters ------
vaz_clust = c("MACHADINHO (217)", "ERNESTINA (110)","MIRANDA (206)","ITAIPU ARTIFICIAL (66)")
#=======================    Funcion Tabla Modelos      ==========================
# ..................
# nclus = 2
#...................
for (nclus in 1:4) {
#.......................................
clima = switch(as.character(nclus),
'1' = Clima1,
'2' = Clima2,
'3' = Clima3,
'4' = Clima4
)
Vazoe = Vazoe2015 %>% filter(Fecha<=clima$Fecha[dim(clima)[1]])
nmb_vazoe = VazoeClima %>% filter(Cluster==nclus) %>% select(Vazoes)
vazoe = Vazoe %>% select(nmb_vazoe$Vazoes)
fecha0r = c(2000,1)
#........................................
ModelosX = list()
NombreXclima = c()
Modelos=list()
# est=1
for(est in seq(dim(vazoe)[2])){
# Estandarizacion de Datos =============================================
{
VazTrain = vazoe[est]
nmb_clim = VazoeClima %>% filter(Vazoes == names(VazTrain)) %>% select(Clima)
if(length(nmb_clim$Clima)>0){
Xtrain = clima %>% select(starts_with(nmb_clim$Clima))
if(dim(Xtrain)[2]==0){
print(paste("+++++ No hay estacion de clima",nmb_clim$Clima,", se uso clima de medoide +++++"))
nmb_clim = VazoeClima %>% filter(Vazoes == vaz_clust[nclus]) %>% select(Clima)
Xtrain = clima %>% select(starts_with(nmb_clim$Clima))
}
}else{
print("*** Error: No existe la variable climatica .....")
break
}
XData = Xtrain ; XData$Fecha = clima$Fecha
Xtrain = ts(Xtrain,start=fecha0r,frequency = 12)
# Xblanc = Xtrain
VazData = VazTrain ; VazData$Fecha = Vazoe$Fecha
VazTrain = ts(VazTrain,start=fecha0r,frequency = 12)
# Cambio Nombre Regresoras
y=window(VazTrain,start=c(2001,1))
XblancNmb = window(Xtrain,start=c(2001,1))
colnames(XblancNmb) = c("Precipitacion","TemperaturaMax","TemperaturaMin","HumedadRelativa")
}
# Modelos SARIMA  ===================================
if(nclus==1){
#Parametros del modelo
p=4;q=0
P=1;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0) retardos = c(retardos,NA)
}
if(nclus==2){
p=4;q=3
P=1;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0) retardos = c(retardos,NA)
}
if(nclus==3){
p=2;q=1
P=1;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0) retardos = c(retardos,NA)
}
if(nclus==4){
p=3;q=2
P=1;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0) retardos = c(retardos,NA)
}
Modelos[[est]] = arima(y,order = c(p,d,q),
seasonal = list(order = c(P,D,Q), period = 12),
fixed = retardos)
# coeftest(Modelos[[est]])
# Modelos  SARIMAX ==========================================================
if(nclus==1){
# Parametros del modelo ...............
media = FALSE
p=1;q=0
P=2;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
#.......................................
# Ordenes Funciones de Respuesta al Impulso
tar1 = 2 #Transf - AR
tma1 = 0 #Transf - MA
tar2 = 0 #Transf - AR
tma2 = 0 #Transf - MA
tar3 = 0 #Transf - AR
tma3 = 0  #Transf - MA
tar4 = 2 #Transf - AR
tma4 = 0  #Transf - MA
tar1_lags = rep(NA, tar1); tma1_lags = rep(NA, tma1+1);
tar2_lags = rep(NA, tar2); tma2_lags = rep(NA, tma2+1);
tar3_lags = rep(NA, tar3); tma3_lags = rep(NA, tma3+1);
tar4_lags = rep(NA, tar4); tma4_lags = rep(NA, tma4+1);
# tar1_lags[5] = 0
# tar4_lags[2] = 0
tma3_lags[1] = 0
tma2_lags[1] = 0
tar4_lags[1] = 0
#........................................
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0 & media) retardos = c(retardos,NA)  # Si include.mean = TRUE  compilar
retardos = c(retardos,
tar1_lags,tma1_lags,
tar2_lags,tma2_lags,
tar3_lags,tma3_lags,
tar4_lags,tma4_lags)
}
if(nclus==2){
# Parametros del modelo ................
media = FALSE
p=1;q=0
P=2;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
#.......................................
# Ordenes Funciones de Respuesta al Impulso
tar1 = 0 #Transf - AR
tma1 = 0 #Transf - MA
tar2 = 0 #Transf - AR
tma2 = 0 #Transf - MA
tar3 = 0 #Transf - AR
tma3 = 0  #Transf - MA
tar4 = 3 #Transf - AR
tma4 = 0  #Transf - MA
tar1_lags = rep(NA, tar1); tma1_lags = rep(NA, tma1+1);
tar2_lags = rep(NA, tar2); tma2_lags = rep(NA, tma2+1);
tar3_lags = rep(NA, tar3); tma3_lags = rep(NA, tma3+1);
tar4_lags = rep(NA, tar4); tma4_lags = rep(NA, tma4+1);
tma1_lags[1] = 0
tma2_lags[1] = 0
tma3_lags[1] = 0
tar4_lags[1] = 0
#........................................
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0 & media) retardos = c(retardos,NA)  # Si include.mean = TRUE  compilar
retardos = c(retardos,
tar1_lags,tma1_lags,
tar2_lags,tma2_lags,
tar3_lags,tma3_lags,
tar4_lags,tma4_lags)
}
if(nclus==3){
# Parametros del modelo ................
media = FALSE
p=1;q=0
P=1;Q=0
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
#.......................................
# Ordenes Funciones de Respuesta al Impulso
tar1 = 1 #Transf - AR
tma1 = 0 #Transf - MA
tar2 = 0 #Transf - AR
tma2 = 0 #Transf - MA
tar3 = 0 #Transf - AR
tma3 = 0  #Transf - MA
tar4 = 0 #Transf - AR
tma4 = 0  #Transf - MA
tar1_lags = rep(NA, tar1); tma1_lags = rep(NA, tma1+1);
tar2_lags = rep(NA, tar2); tma2_lags = rep(NA, tma2+1);
tar3_lags = rep(NA, tar3); tma3_lags = rep(NA, tma3+1);
tar4_lags = rep(NA, tar4); tma4_lags = rep(NA, tma4+1);
tma3_lags[1] = 0
tma4_lags[1] = 0
# tar4_lags[1] = 0
#........................................
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0 & media) retardos = c(retardos,NA)  # Si include.mean = TRUE  compilar
retardos = c(retardos,
tar1_lags,tma1_lags,
tar2_lags,tma2_lags,
tar3_lags,tma3_lags,
tar4_lags,tma4_lags)
}
if(nclus==4){
# Parametros del modelo ................
media = FALSE
p=0;q=3
P=1;Q=1
d=0;D=1
p_lags = rep(NA, p);q_lags = rep(NA, q)
P_lags = rep(NA, P);Q_lags = rep(NA, Q)
#.......................................
# Ordenes Funciones de Respuesta al Impulso
tar1 = 0 #Transf - AR
tma1 = 0 #Transf - MA
tar2 = 0 #Transf - AR
tma2 = 0 #Transf - MA
tar3 = 0 #Transf - AR
tma3 = 0  #Transf - MA
tar4 = 0 #Transf - AR
tma4 = 0  #Transf - MA
tar1_lags = rep(NA, tar1); tma1_lags = rep(NA, tma1+1);
tar2_lags = rep(NA, tar2); tma2_lags = rep(NA, tma2+1);
tar3_lags = rep(NA, tar3); tma3_lags = rep(NA, tma3+1);
tar4_lags = rep(NA, tar4); tma4_lags = rep(NA, tma4+1);
# tar1_lags[5] = 0
# tar4_lags[2] = 0
tma1_lags[1] = 0
tma3_lags[1] = 0
tma2_lags[1] = 0
#........................................
retardos = c(p_lags,q_lags,P_lags,Q_lags)
if(d==0 & D==0 & media) retardos = c(retardos,NA)  # Si include.mean = TRUE  compilar
retardos = c(retardos,
tar1_lags,tma1_lags,
tar2_lags,tma2_lags,
tar3_lags,tma3_lags,
tar4_lags,tma4_lags)
}
ModelosX[[est]] = arimax(y, order = c(p,d,q),include.mean = media,
seasonal = list(order = c(P,D,Q),
period = 12),
fixed = retardos,
# fixed = NULL,
xtransf = XblancNmb, transfer = list(c(tar1,tma1),
c(tar2,tma2),
c(tar3,tma3),
c(tar4,tma4))
)
NombreXclima[est] = nmb_clim$Clima
print(paste("Caudal:",names(vazoe[est]),"***********"))
print(paste("Clima:",nmb_clim$Clima))
# coeftest(ModelosX[[est]])
}
names(Modelos) = names(vazoe)
names(ModelosX) = names(vazoe)
save(Modelos,file=paste0("Modelos/SARIMA",nclus,".RData"))
save(ModelosX,NombreXclima,file=paste0("Modelos/SARIMAX",nclus,".RData"))
}
toc()
#-------
names(ModelosX)
ModelosX[[vaz_clust[2]]]
vaz_clust = c("MACHADINHO (217)", "ERNESTINA (110)","MIRANDA (206)","ITAIPU ARTIFICIAL (66)")
vaz_clust[2]
ModelosX[[vaz_clust[4]]]
load("C:/Users/Asus/Desktop/TESIS Git Rnw/RnwTsis/Resultados/Extras/Modelos/SARIMAX3.RData")
TABLAX = ResumenModelos(ModelosX)
load(file = "Resultados/Extras/sarima_representantes.RData")
load("C:/Users/Asus/Desktop/TESIS Git Rnw/RnwTsis/Resultados/Extras/sarima_representantes.RData")
NombreXclima
TABLAX$`Estacion-Clima` = NombreXclima
load("C:/Users/Asus/Desktop/TESIS Git Rnw/RnwTsis/Resultados/Extras/Modelos/SARIMA3.RData")
TABLA = ResumenModelos(Modelos)
texto = paste0(texto," - Cl√∫ster 3")
p=2;q=1
P=1;Q=0
d=0;D=1
texto = paste0("SARIMA$(",p,",",d,",",q,")(",P,",",D,",",Q,")_{12}$")
TABLA = ResumenModelos(Modelos)
TABLA
load("C:/Users/Asus/Desktop/TESIS Git Rnw/RnwTsis/Resultados/Extras/Modelos/SARIMAX3.RData")
p=1;q=0
P=1;Q=0
d=0;D=1
texto = paste0("SARIMAX$(",p,",",d,",",q,")(",P,",",D,",",Q,")_{12}$")
TABLAX = ResumenModelos(ModelosX); TABLAX$`Estacion-Clima` = NombreXclima
TABLAX
load("C:/Users/Asus/Desktop/TESIS Git Rnw/RnwTsis/Resultados/Extras/Modelos/SARIMAX4.RData")
load("C:/Users/Asus/Desktop/TESIS Git Rnw/RnwTsis/Resultados/Extras/Modelos/SARIMAX1.RData")
load("C:/Users/Asus/Desktop/TESIS Git Rnw/RnwTsis/Resultados/Extras/Modelos/SARIMAX1.RData")
TABLAX = ResumenModelos(ModelosX);
View(TABLAX)
TABLAX[14,1]
NombreXclima
library(plyr)
library(ggplot2)
library(maptools)
input<-read.table("~/Dropbox/London_visualized_working/commute_flows/wu03ew_v1.csv", sep=",", header=T)
input<- input[,1:3]
names(input)<- c("origin", "destination","total")
centroids<- read.csv("~/Dropbox/London_visualized_working/commute_flows/msoa_popweightedcentroids.csv")
#Lots of joining to get the xy coordinates joined to the origin and then the destination points.
or.xy<- merge(input, centroids, by.x="origin", by.y="Code")
names(or.xy)<- c("origin", "destination", "trips", "o_name", "oX", "oY")
dest.xy<-  merge(or.xy, centroids, by.x="destination", by.y="Code")
names(dest.xy)<- c("origin", "destination", "trips", "o_name", "oX", "oY","d_name", "dX", "dY")
xquiet<- scale_x_continuous("", breaks=NULL)
yquiet<-scale_y_continuous("", breaks=NULL)
quiet<-list(xquiet, yquiet)
ggplot(dest.xy[which(dest.xy$trips>10),], aes(oX, oY))+
#The next line tells ggplot that we wish to plot line segments. The "alpha=" is line transparency and used below
geom_segment(aes(x=oX, y=oY,xend=dX, yend=dY, alpha=trips), col="white")+
#Here is the magic bit that sets line transparency - essential to make the plot readable
scale_alpha_continuous(range = c(0.03, 0.3))+
#Set black background, ditch axes and fix aspect ratio
theme(panel.background = element_rect(fill='black',colour='black'))+quiet+coord_equal()
library("nycflights13")
install.packages("nycflights13")
library(nycflights13)
airports
flights
airports = airports
flights = flights
View(airports)
View(flights)
